<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Intwari AI ‚Äì Rwanda Heroes Intelligence</title>

<style>
:root{
 --primary:#1A5276;
 --secondary:#FFD700;
 --bg:#f4f6f7;
 --ai:#E8EAF6;
 --user:#DCF8C6;
}
body{margin:0;font-family:Arial;background:var(--bg);}
header{display:flex;align-items:center;gap:15px;background:var(--primary);color:white;padding:10px 20px;}
header img{height:55px;border-radius:8px;}
#app{max-width:1100px;margin:auto;padding:15px;}
#chat{background:white;border-radius:10px;height:420px;overflow-y:auto;padding:10px;display:flex;flex-direction:column-reverse;}
.msg{max-width:78%;padding:10px;margin:5px;border-radius:15px;animation:fade .3s;}
.user{align-self:flex-end;background:var(--user);}
.ai{align-self:flex-start;background:var(--ai);}
.highlight{background:yellow;}
img.hero{width:140px;border-radius:8px;margin-top:5px;}
#controls{display:flex;gap:5px;margin-top:10px;flex-wrap:wrap;}
#controls input{flex:1;padding:8px;border-radius:5px;border:1px solid #ccc;}
button{background:var(--secondary);border:none;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:bold;}
.panel{background:white;margin-top:15px;padding:10px;border-radius:8px;}
.hidden{display:none}
@keyframes fade{from{opacity:0}to{opacity:1}}
</style>
</head>

<body>

<header>
<img src="https://upload.wikimedia.org/wikipedia/commons/1/17/Flag_of_Rwanda.svg">
<h2>INTWARI AI ‚Äì Rwanda Heroes Intelligence</h2>
</header>

<div id="app">

<div id="chat"></div>

<div id="controls">
<input id="q" placeholder="Ask about a Rwandan hero / Baza Intwari">
<button onclick="ask()">Ask</button>
<button onclick="toggleLang()">üåç</button>
<button onclick="showQuiz()">üß† Quiz</button>
<button onclick="adminLogin()">üîê Admin</button>
</div>

<div id="quiz" class="panel hidden"></div>
<div id="admin" class="panel hidden"></div>
<div id="logs" class="panel"><b>Session Log</b><div id="logData"></div></div>

<p style="font-size:12px">
Administrator: <a href="mailto:manzipros@gmail.com">manzipros@gmail.com</a>
</p>

</div>

<script>
let lang="en";
let admin=false;

// ===== LOCAL DATABASE =====
let heroes=JSON.parse(localStorage.getItem("heroes"))||[
 {en:"King Mutara III Rudahigwa",rw:"Umwami Mutara III Rudahigwa",
 values:["unity","ubumwe","king"],
 story_en:"A Rwandan king who promoted unity and cared deeply for his people.",
 story_rw:"Umwami w‚Äôu Rwanda wateje imbere ubumwe n‚Äôimibereho myiza.",
 img:"https://upload.wikimedia.org/wikipedia/commons/8/85/Mutara_III_Rudahigwa.jpg"}
];

let cache=JSON.parse(localStorage.getItem("cache"))||{};

function save(){localStorage.setItem("heroes",JSON.stringify(heroes));}
function saveCache(){localStorage.setItem("cache",JSON.stringify(cache));}

function addMsg(txt,type){
 let d=document.createElement("div");
 d.className="msg "+type;
 d.innerHTML=txt;
 document.getElementById("chat").prepend(d);
}

function log(t){
 document.getElementById("logData").innerHTML+=t+"<br>";
}

// ===== MAIN AI FUNCTION =====
async function ask(){
 let q=document.getElementById("q").value.trim();
 if(!q)return;
 addMsg(q,"user");
 log(q);
 document.getElementById("q").value="";

 let found=heroes.find(h=>
  q.toLowerCase().includes(h.en.toLowerCase()) ||
  q.toLowerCase().includes(h.rw.toLowerCase()) ||
  h.values.some(v=>q.toLowerCase().includes(v))
 );

 if(found){
  let t=lang=="en"?found.story_en:found.story_rw;
  addMsg(format(`<img class="hero" src="${found.img}"><br>${t}`,q)+confidence("High"),"ai");
 }else{
  let ai = await silentSearch(q);
  addMsg(ai,"ai");
 }
}

// ===== SILENT INTERNET SEARCH + CACHE =====
async function silentSearch(query){
 if(cache[query]) return cache[query]+confidence("Medium");

 try{
  let r=await fetch("https://en.wikipedia.org/api/rest_v1/page/summary/"+encodeURIComponent(query));
  if(!r.ok) throw 0;
  let d=await r.json();
  let text=d.extract||"";
  let timeline = d.description && d.description.match(/\d{4}/) ? `<br><b>Timeline:</b> ${d.description}`:"";
  let result = format(`<b>${d.title}</b><br>${text}${timeline}`,query);
  cache[query]=result;
  saveCache();
  return result+confidence("Medium");
 }catch{
  return lang=="en"
   ?"I could not find reliable information yet."+confidence("Low")
   :"Sinabonye amakuru yizewe."+confidence("Low");
 }
}

// ===== HIGHLIGHT KEYWORDS =====
function format(text,query){
 query.split(" ").forEach(w=>{
  if(w.length>3)
   text=text.replaceAll(new RegExp(w,"gi"),`<span class="highlight">${w}</span>`);
 });
 return text;
}

// ===== CONFIDENCE =====
function confidence(level){
 return `<br><i>AI confidence: ${level}</i>`;
}

// ===== LANGUAGE =====
function toggleLang(){
 lang=lang=="en"?"rw":"en";
 alert(lang=="en"?"English":"Kinyarwanda");
}

// ===== ADMIN =====
function adminLogin(){
 let e=prompt("Admin email:");
 if(e==="manzipros@gmail.com"){admin=true;showAdmin();}
 else alert("Access denied");
}

function showAdmin(){
 let a=document.getElementById("admin");
 a.classList.remove("hidden");
 a.innerHTML=`
 <h3>Admin Dashboard</h3>
 <input id="hen" placeholder="Hero name EN">
 <input id="hrw" placeholder="Hero name RW">
 <input id="val" placeholder="Values comma separated">
 <textarea id="sen" placeholder="Story EN"></textarea>
 <textarea id="srw" placeholder="Story RW"></textarea>
 <input type="file" id="img">
 <button onclick="saveHero()">Save Hero</button>
 `;
}

function saveHero(){
 let r=new FileReader();
 r.onload=()=>{
  heroes.push({
   en:hen.value,rw:hrw.value,
   values:val.value.split(","),
   story_en:sen.value,
   story_rw:srw.value,
   img:r.result
  });
  save();
  alert("Hero added");
 };
 r.readAsDataURL(img.files[0]);
}

// ===== QUIZ =====
function showQuiz(){
 let q=document.getElementById("quiz");
 q.classList.toggle("hidden");
 q.innerHTML="<h3>Quiz</h3>Who promoted unity?<br><input id='qa'><button onclick='checkQ()'>Check</button>";
}
function checkQ(){
 alert(document.getElementById("qa").value.toLowerCase().includes("mutara")?"Correct":"Try again");
}
</script>

</body>
</html>
